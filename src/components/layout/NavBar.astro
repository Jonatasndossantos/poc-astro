---
import { getRelativeLocaleUrl } from "astro:i18n";
import ThemeToggle from "../ui/ThemeToggle.astro";
import LanguageToggle from "./LanguageToggle.astro";
import { getTranslations } from "@i18n";
import { useTranslatedPath } from "@i18n";
import Icon from "./Icon.astro";
import { iconPaths } from "../IconPaths";
import { Layers, Menu } from "lucide-react";

const { lang } = Astro.props;
const translatePath = useTranslatedPath(lang);

const navRecord = (await getTranslations(lang, "nav")) as Record<
    string,
    string
>;
const themeRecord = (await getTranslations(lang, "theme")) as Record<
    string,
    string
>;

const iconLinks: {
    label: string;
    href: string;
    icon: keyof typeof iconPaths;
}[] = [
    {
        label: "GitHub",
        href: "https://github.com/jonatasndossantos",
        icon: "github-logo",
    },
];
---

<div class="drawer drawer-end fixed top-0 w-full z-50 pointer-events-none">
    <input
        id="nav-drawer"
        type="checkbox"
        class="drawer-toggle"
        aria-label="Toggle Navigation"
    />

    <div class="drawer-content pointer-events-auto flex flex-col w-full">
        <!-- Navbar -->
        <div
            class="navbar w-full bg-base-100/90 backdrop-blur-xl border-b border-base-content/10 text-base-content"
        >
            <div
                class="mx-auto flex w-full max-w-7xl items-center px-4 sm:px-6 lg:px-8"
            >
                <div class="navbar-start">
                    <a
                        href={translatePath("/")}
                        class="btn btn-ghost h-auto py-2 px-3 gap-3"
                    >
                        <div
                            class="relative flex items-center justify-center size-8"
                        >
                            <Layers
                                className="size-6 relative z-10 transition-transform hover:rotate-12 text-primary"
                            />
                            <div
                                class="absolute inset-0 blur-md rounded-full bg-base-content/10"
                            >
                            </div>
                        </div>
                        <div class="flex flex-col text-left">
                            <span
                                class="font-bold text-base leading-tight tracking-wider text-base-content group-hover:text-primary transition-colors"
                            >
                                {(navRecord.name ?? "").toUpperCase()}
                                <span class="opacity-50"
                                    >{
                                        (navRecord.prefix ?? "").toUpperCase()
                                    }</span
                                >
                            </span>
                            <span
                                class="text-[10px] uppercase tracking-[0.2em] opacity-60 mt-0.5"
                            >
                                {navRecord.title ?? ""}
                            </span>
                        </div>
                    </a>
                </div>

                <div class="navbar-end gap-2 pr-2 w-full flex justify-end">
                    <div class="hidden lg:flex items-center gap-2">
                        {
                            iconLinks.map((link) => (
                                <a
                                    href={link.href}
                                    class="btn btn-ghost btn-sm btn-circle"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    title={link.label}
                                    aria-label={link.label}
                                >
                                    <Icon icon={link.icon} size="1.2rem" />
                                    <span class="sr-only">{link.label}</span>
                                </a>
                            ))
                        }
                        <div class="w-px h-6 bg-base-content/20 mx-2"></div>
                        <ThemeToggle locale={lang} themeDict={themeRecord} />
                        <div class="w-px h-6 bg-base-content/20 mx-2"></div>
                        <LanguageToggle currentLocale={lang} />
                    </div>

                    <!-- Hamburger Mobile (Now on the right) -->
                    <div class="flex-none lg:hidden">
                        <button
                            type="button"
                            onclick="document.getElementById('nav-drawer').click()"
                            aria-label="open sidebar"
                            class="btn btn-square btn-ghost"
                        >
                            <Menu className="size-6" />
                            <span class="sr-only">Open Menu</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Sidebar -->
    <div class="drawer-side pointer-events-auto z-[100]">
        <div
            onclick="document.getElementById('nav-drawer').click()"
            aria-hidden="true"
            class="drawer-overlay"
        >
        </div>
        <div
            class="flex flex-col p-6 w-80 min-h-full bg-base-200 text-base-content shadow-2xl"
        >
            <div
                class="flex items-center justify-between mb-8 pb-4 border-b border-base-content/10"
            >
                <span class="text-xl font-bold">Preferences</span>
                <button
                    type="button"
                    onclick="document.getElementById('nav-drawer').click()"
                    aria-label="close sidebar"
                    class="btn btn-circle btn-ghost btn-sm"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        aria-hidden="true"
                        ><path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M6 18L18 6M6 6l12 12"></path></svg
                    >
                    <span class="sr-only">Close Menu</span>
                </button>
            </div>

            <div class="flex flex-col gap-6">
                <!-- Socials -->
                <div class="flex flex-col gap-3">
                    <span
                        class="text-sm font-medium opacity-60 uppercase tracking-widest px-1"
                        >Network</span
                    >
                    <div class="flex flex-row flex-wrap gap-2">
                        {
                            iconLinks.map((link) => (
                                <a
                                    href={link.href}
                                    class="btn btn-ghost btn-square bg-base-100 hover:bg-base-300 transition-colors"
                                    target="_blank"
                                    rel="noopener"
                                    title={link.label}
                                    aria-label={link.label}
                                >
                                    <Icon icon={link.icon} size="1.5rem" />
                                    <span class="sr-only">{link.label}</span>
                                </a>
                            ))
                        }
                    </div>
                </div>

                <!-- Settings -->
                <div class="flex flex-col gap-4 mt-4">
                    <span
                        class="text-sm font-medium opacity-60 uppercase tracking-widest px-1"
                        >Interface</span
                    >
                    <div class="flex flex-col gap-4 bg-base-100 p-4 rounded-xl">
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-sm">Theme</span>
                            <ThemeToggle
                                locale={lang}
                                themeDict={themeRecord}
                            />
                        </div>
                        <div class="divider my-0 opacity-20"></div>
                        <div class="flex items-center justify-between">
                            <span class="font-medium text-sm">Language</span>
                            <LanguageToggle currentLocale={lang} />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
